<style>

  .container {
    max-width: 1000px;
    margin: 60px auto;
    padding: 0 20px;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  }

  .main-title {
    font-size: 3.5rem;
    font-weight: 900;
    text-transform: uppercase;
    letter-spacing: -2px;
    margin-bottom: 40px;
    line-height: 0.9;
  }

  .tab-radio { display: none; }

  .industrial-nav {
    display: flex;
    border: 3px solid black;
    width: fit-content;
    margin-bottom: 50px;
    background: white;
  }

  .nav-item {
    padding: 12px 30px;
    font-weight: 800;
    font-size: 0.85rem;
    text-transform: uppercase;
    cursor: pointer;
    transition: 0.2s;
    border-right: 3px solid black;
    letter-spacing: 1px;
  }

  .nav-item:last-child { border-right: none; }

  .nav-item:hover { background: #f4f4f4; }


  #tab-pending:checked ~ .industrial-nav label[for="tab-pending"],
  #tab-completed:checked ~ .industrial-nav label[for="tab-completed"] {
    background: black;
    color: white;
  }

  .tab-content { display: none; }

  #tab-pending:checked ~ #pending-section,
  #tab-completed:checked ~ #completed-section {
    display: block;
  }

  .deal-card {
    background: white;
    border: 2px solid black;
    padding: 25px;
    margin-bottom: 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .deal-info h4 {
    font-size: 1.2rem;
    font-weight: 800;
    text-transform: uppercase;
    margin: 0;
  }

  .price-text {
    font-family: monospace;
    font-weight: 700;
    margin: 5px 0;
    font-size: 0.95rem;
  }

  .status-badge {
    display: inline-block;
    padding: 4px 8px;
    background: #f0f0f0;
    border: 1px solid black;
    font-size: 0.65rem;
    font-weight: 800;
    text-transform: uppercase;
  }

  /* 4. Buttons */
  .btn-industrial {
    text-decoration: none;
    color: black;
    font-weight: 700;
    font-size: 0.75rem;
    padding: 10px 18px;
    border: 2px solid black;
    text-transform: uppercase;
    background: white;
    display: inline-block;
    transition: 0.2s;
  }

  .btn-industrial:hover {
    background: black;
    color: white;
  }

  .btn-dark { background: black; color: white; }

  
  .modal-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(255,255,255,0.98);
    z-index: 9999;
    justify-content: center;
    align-items: center;
  }
  .modal-overlay:target { display: flex !important; }

  .modal-content {
    border: 3px solid black;
    padding: 50px;
    width: 400px;
    text-align: center;
    position: relative;
  }
</style>

<div class="container">
  
  <h1 class="main-title">MY<br>DEALS</h1>

  <input type="radio" name="nav_toggle" id="tab-pending" class="tab-radio" checked>
  <input type="radio" name="nav_toggle" id="tab-completed" class="tab-radio">

  <div class="industrial-nav">
    <label for="tab-pending" class="nav-item">Active Actions (<%= @pending_deals.count %>)</label>
    <label for="tab-completed" class="nav-item">History (<%= @completed_deals.count %>)</label>
  </div>

  <%# SECTION: PENDING %>
  <div id="pending-section" class="tab-content">
    <div class="deals-container">
      <%= render partial: "deal-item", collection: @pending_deals, as: :deal %>
    </div>
  </div>

  <%# SECTION: COMPLETED %>
<%# SECTION: COMPLETED %>
<div id="completed-section" class="tab-content">
  <div class="deals-container">
    <% if @completed_deals.any? %>
      <% @completed_deals.each do |deal| %>
        <div class="deal-card">
          <div class="deal-info">
            <div class="status-badge" style="margin-bottom: 10px; background: #b7ebcd; color: #155724;">SUCCESS</div>
            <h4><%= deal.item.title.truncate(20) %></h4>
            <div class="price-text">VALUE: <%= number_to_currency(deal.agreed_price) %></div>
            <div style="font-size: 0.65rem; color: #888;">CLOSED: <%= deal.updated_at.strftime("%b %d, %y") %></div>
          </div>

          <div class="card-footer" style="margin-top: 20px; border-top: 1px solid #000; padding-top: 15px;">
            <div style="font-size: 0.6rem; font-weight: 800; text-transform: uppercase; color: #888; margin-bottom: 5px;">
              Partner: <%= deal.item.seller.userable.name %>
            </div>
            <div style="display: flex; flex-direction: column; gap: 8px;">
              <%= link_to "VIEW ITEM", item_path(deal.item), class: "btn-industrial", style: "text-align:center" %>
              <%unless (current_user.seller==deal.conversation.seller_profile)%>
              <%= link_to "PROFILE", seller_path(deal.item.seller), class: "btn-industrial", style: "background: #f9f9f9;" %>
              <%else%>
              <%= link_to "PROFILE", seller_path(deal.conversation.buyer_profile), class: "btn-industrial", style: "background: #f9f9f9;" %>
              <%end%> 
              <% unless current_user.seller == deal.item.seller %>
                <%= link_to "RATE SELLER", "#review-modal-#{deal.id}", class: "btn-industrial btn-dark", style: "text-align:center", data: { turbo: false } %>
              <% end %>
           

<div id="review-modal-<%= deal.id %>" class="modal-overlay">
  <div class="modal-content">
    <a href="#" class="btn-industrial" style="position: absolute; top: 10px; right: 10px;">X</a>
    <h2 class="main-title" style="font-size: 1.5rem;">Rate Experience</h2>
    
    <%# 1. Added data: { turbo: false } to the form %>
    <%# 2. Used a fresh Review object explicitly %>
<%= form_with(model: [deal, Review.new], 
              url: create_review_deal_reviews_path(deal), 
              method: :post, 
              local: true,
              data: { turbo: false }) do |f| %>
      <div style="margin-bottom: 20px; text-align: left;">
        <%= f.label :rating, "Rating (1.0 - 5.0)", class: "price-text" %><br>
        <%= f.number_field :rating, step: 0.1, in: 1..5, class: "btn-industrial", style: "width: 100%;" %>
      </div>

      <div style="margin-bottom: 20px; text-align: left;">
        <%= f.label :comment, "Your Feedback", class: "price-text" %><br>
        <%= f.text_area :comment, rows: 3, class: "btn-industrial", style: "width: 100%;" %>
      </div>

      <%# 3. Ensure this is a standard f.submit %>
      <%= f.submit "SUBMIT REVIEW", class: "btn-industrial btn-dark", style: "width: 100%; cursor: pointer;" %>
    <% end %>
  </div>
</div>
            </div>
          </div>
        </div>
      <% end %>
    <% else %>
      <div style="padding: 100px 0; text-align: center; border: 2px dashed #eee; color: #ccc; font-weight: 800; text-transform: uppercase;">
        History Empty
      </div>
    <% end %>
  </div>
</div>