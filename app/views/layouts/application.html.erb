<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) || "Olx" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <link rel="manifest" href="/manifest.json">
    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">
    <link
      href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css"
      rel="stylesheet"
    />

    <script
      src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"
      defer
    ></script>

    <%= stylesheet_link_tag 'application', media: 'all', 'data-turbo-track': 'reload' %>
<%= yield :extra_styles %>

    <%= stylesheet_link_tag "deal", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
    <script>
    // This runs immediately before the page renders to prevent flashing
    const savedTheme = localStorage.getItem('theme') || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);
  </script>
  </head>

  <body>
<nav class="navbar">
  <div class="nav-container">
    <div class="nav-left">
      <%= link_to "MARKETPLACE", root_path, class: "logo" %>
      <%= link_to "All Items", items_path, class: "nav-link" %>
    </div>

    <div class="nav-right">
      <% if user_signed_in? %>
        <div class="user-tools">
          <%= link_to likes_path, class: "tool-item", title: "Favorites" do %>
            <span class="icon">â¤</span> Favs
          <% end %>
          <%= link_to conversations_path, class: "tool-item", title: "Messages" do %>
            <span class="icon">ğŸ’¬</span> Chat
          <% end %>
          <%= link_to deals_path, class: "tool-item", title: "My Deals" do %>
            <span class="icon">ğŸ“¦</span> Deals
          <% end %>
        </div>
        
    <button id="theme-btn" class="theme-toggle">
      <span id="theme-icon">ğŸŒ™</span>
    </button>

        <div class="profile-meta">
          <%= link_to seller_path(current_user.seller), class: "account-link" do %>
            <span class="greeting">Hello, <%= current_user.name.split.first %></span>
            <span class="sub-text">Account & Profile</span>
          <% end %>
          
          <%= link_to "Logout", destroy_user_session_path, 
                      data: { turbo_method: :delete }, 
                      class: "logout-btn" %>
        </div>

        <%= link_to "SELL ITEM", new_item_path, class: "btn-sell" %>

      <% else %>
        <%= link_to "Sign In", new_user_session_path, class: "signin-link" %>
      <% end %>
    </div>
  </div>
</nav>



<%# app/views/layouts/application.html.erb %>
<%= render "items/search_bar" if current_page?(root_path) || (controller_name == "items" && action_name == "index") %>




<% if notice %>
  <div class="flash-message notice" data-controller="flash">
    <%= notice %>
    <button type="button" class="close-btn" data-action="click->flash#dismiss">&times;</button>
  </div>
<% end %>

<% if alert %>
  <div class="flash-message alert" data-controller="flash">
    <%= alert %>
    <button type="button" class="close-btn" data-action="click->flash#dismiss">&times;</button>
  </div>
<% end %>
    <main class="container">
    <%= yield %>
  </main>
  </body>
</html>
